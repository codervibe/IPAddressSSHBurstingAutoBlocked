# IPAddressSSHBurstingAutoBlocked
对SSH爆破行为的IP自动封禁
# 自动封禁IP脚本说明

## 1. 文件概述
`autoBlockIP.py` 是一个用于自动检测并封禁频繁尝试非法SSH登录的IP地址的Python脚本。该脚本通过监控Linux系统的安全日志文件（通常为`/var/log/secure`），当发现某个IP地址的非法登录尝试超过设定阈值时，会将该IP地址添加到黑名单文件`/etc/hosts.deny`中。

## 2. 主要功能
- **监控安全日志**：实时读取并解析安全日志文件中的登录失败记录。
- **统计错误次数**：统计每个IP地址的密码错误次数。
- **封禁IP地址**：当某个IP地址的密码错误次数超过设定阈值时，将其加入黑名单文件。
- **处理不存在的用户**：对于不存在的用户尝试登录的情况，直接封禁该IP地址。

## 3. 关键配置
- `securityLog`：指定安全日志文件路径，默认为`/var/log/secure`。
- `hostDeny`：指定黑名单文件路径，默认为`/etc/hosts.deny`。
- `BlockThreshold`：设置密码错误次数的阈值，默认为5次。

## 4. 代码结构
### 4.1 函数定义
- `getDenies()`：
  - 获取当前黑名单文件中的所有IP地址，并返回一个字典形式的列表。
  
- `monitor(securityLog)`：
  - 实时监控安全日志文件，统计每个IP地址的密码错误次数。
  - 当某个IP地址的错误次数超过阈值或存在无效用户时，将其加入黑名单文件。

### 4.2 主程序入口
- `if __name__ == '__main__':`
  - 调用`monitor(securityLog)`函数开始监控。

## 5. 注意事项
- **权限要求**：脚本需要以root权限运行，以便能够修改`/etc/hosts.deny`文件。
- **日志格式**：脚本依赖于特定的日志格式，确保系统日志格式与脚本中的正则表达式匹配。
- **性能影响**：长时间运行可能会占用一定的系统资源，建议在生产环境中谨慎使用。



## 7. 使用示例
~~~
sudo python3 autoBlockIP.py
~~~
## 8. 依赖库
- `re`：用于正则表达式匹配。
- `subprocess`：用于执行系统命令。
- `time`：用于时间处理。

